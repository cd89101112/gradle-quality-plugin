



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Gradle quality plugin for Java and Groovy">
      
      
        <link rel="canonical" href="https://xvik.github.io/gradle-quality-plugin/4.2.0/tool/cpd/">
      
      
        <meta name="author" content="Vyacheslav Rusakov">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>CPD - Gradle quality plugin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cpd-copypaste-detector" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://xvik.github.io/gradle-quality-plugin/4.2.0" title="Gradle quality plugin" aria-label="Gradle quality plugin" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Gradle quality plugin
            </span>
            <span class="md-header-nav__topic">
              
                CPD
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="http://github.com/xvik/gradle-quality-plugin/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    gradle-quality-plugin
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://xvik.github.io/gradle-quality-plugin/4.2.0" title="Gradle quality plugin" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Gradle quality plugin
  </label>
  
    <div class="md-nav__source">
      


  

<a href="http://github.com/xvik/gradle-quality-plugin/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    gradle-quality-plugin
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      User guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        User guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/automatic/" title="Automatic mode" class="md-nav__link">
      Automatic mode
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/config/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/exclusion/" title="Exclusion" class="md-nav__link">
      Exclusion
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../guide/profile/" title="Profile" class="md-nav__link">
      Profile
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lint/" title="Javac lint" class="md-nav__link">
      Javac lint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../checkstyle/" title="Checkstyle" class="md-nav__link">
      Checkstyle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pmd/" title="PMD" class="md-nav__link">
      PMD
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        CPD
      </label>
    
    <a href="./" title="CPD" class="md-nav__link md-nav__link--active">
      CPD
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    Config
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpd-tasks" class="md-nav__link">
    Cpd tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-file-types-support" class="md-nav__link">
    Multiple file types support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-module-projects" class="md-nav__link">
    Multi-module projects
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suppress" class="md-nav__link">
    Suppress
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../spotbugs/" title="SpotBugs" class="md-nav__link">
      SpotBugs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../codenarc/" title="CodeNarc" class="md-nav__link">
      CodeNarc
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../animalsniffer/" title="Animalsniffer" class="md-nav__link">
      Animalsniffer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Tasks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Tasks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../task/config/" title="Copy config" class="md-nav__link">
      Copy config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../task/group/" title="Group" class="md-nav__link">
      Group
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/history/" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/compatibility/" title="Compatibility" class="md-nav__link">
      Compatibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#config" class="md-nav__link">
    Config
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpd-tasks" class="md-nav__link">
    Cpd tasks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multiple-file-types-support" class="md-nav__link">
    Multiple file types support
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-module-projects" class="md-nav__link">
    Multi-module projects
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#suppress" class="md-nav__link">
    Suppress
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="http://github.com/xvik/gradle-quality-plugin/edit/master/src/doc/docs/tool/cpd.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="cpd-copypaste-detector">CPD (Copy/Paste Detector)<a class="headerlink" href="#cpd-copypaste-detector" title="Permanent link">&para;</a></h1>
<div class="admonition summary">
<p>Java by default, suitable for anything (groovy, jsp, simple text etc.) | 
<a href="https://pmd.github.io/latest/pmd_userdocs_cpd.html">Home</a> |
<a href="https://github.com/aaschmid/gradle-cpd-plugin">Plugin</a>   </p>
</div>
<p>CPD support activates only when <a href="https://github.com/aaschmid/gradle-cpd-plugin">de.aaschmid.cpd</a> 
gradle plugin applied manually:</p>
<div class="codehilite"><pre><span></span><code><span class="n">plugins</span> <span class="o">{</span>        
    <span class="n">id</span> <span class="s1">&#39;de.aaschmid.cpd&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.1&#39;</span>
    <span class="n">id</span> <span class="s1">&#39;ru.vyarus.quality&#39;</span> <span class="n">version</span> <span class="s1">&#39;4.2.0&#39;</span>
<span class="o">}</span>
</code></pre></div>

<p>CPD is a part of <a href="../pmd/">PMD</a> project and so there is no need for additional version configuration (pmd version used). </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Special <a href="https://github.com/xvik/gradle-quality-plugin/blob/master/src/main/resources/ru/vyarus/quality/config/cpd/cpdhtml.xslt">xsl file</a> 
used for manual html report generation because plugin does not support html report. This is <a href="https://github.com/pmd/pmd/blob/master/pmd-core/etc/xslt/cpdhtml.xslt">official pmd style</a>,
but modified to show all duplicates (original script shows only duplicates &gt; 30 lines).</p>
</div>
<h2 id="output">Output<a class="headerlink" href="#output" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span><code>2 java duplicates were found by CPD

sample.cpd.(OtherStruct1.java:3)  [16 lines / 75 tokens]
sample.cpd.(OtherStruct2.java:3)
  │
 3│    public class OtherStruct1 {
 4│    
 5│        public static void main(String[] args) {
 6│            Math.sqrt(12);
 7│            Math.sqrt(12);
 8│            Math.sqrt(12);
 9│            Math.sqrt(12);
10│            Math.sqrt(12);
11│            Math.sqrt(12);
12│            Math.sqrt(12);
13│            Math.sqrt(12);
14│            Math.sqrt(12);
15│            Math.sqrt(12);
16│        }
17│    
18│        public void differentMethod1() {
</code></pre></div>

<p>Shows all files with duplicate parts and source sample from the first file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Order of files may vary on different environments and so you may see sources from different files
in the resulted report. It doesn't matter much, just don't be surprised. </p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Tool does not search for exact matches, instead it tries to find very common blocks:
for example, some code block could be copied and slightly modified and cpd will be able to match it.</p>
</div>
<h2 id="config">Config<a class="headerlink" href="#config" title="Permanent link">&para;</a></h2>
<p>Config options with defaults:</p>
<div class="codehilite"><pre><span></span><code><span class="n">quality</span> <span class="o">{</span>
    <span class="n">cpd</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// false to disable plugin configuration</span>
    <span class="n">cpdUnifySources</span> <span class="o">=</span> <span class="kc">true</span> <span class="c1">// false to not modify cpdCheck task sources</span>
<span class="o">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CPD itself may be configured with plugin's <a href="https://github.com/aaschmid/gradle-cpd-plugin#options"><code>cpd</code> closure</a></p>
</div>
<p>Configurations applied by plugin:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cpd</span> <span class="o">{</span>
    <span class="n">toolVersion</span> <span class="o">=</span> <span class="n">quality</span><span class="o">.</span><span class="na">pmdVersion</span>
    <span class="n">ignoreFailures</span> <span class="o">=</span> <span class="o">!</span><span class="n">extension</span><span class="o">.</span><span class="na">strict</span>
<span class="o">}</span>
</code></pre></div>

<p>If only groovy sources available, then <code>cpd.language</code> automatically set to <code>groovy</code>
(but only if cpd task declared in the same module with quality plugin!). </p>
<h3 id="cpd-tasks">Cpd tasks<a class="headerlink" href="#cpd-tasks" title="Permanent link">&para;</a></h3>
<p>In contrast to other quality tools CPD plugin registers only one task <code>cpdCheck</code> instead of task per source set
(otherwise it would be impossible to find duplicates between source sets or even between different modules).</p>
<p>By default, <code>cpdCheck</code> task configured to check all available source sets. But quality plugin will
modify <code>chpdCheck.source</code>:</p>
<ul>
<li>All files from source sets, not configured for quality checks (<code>quality.sourceSets</code>) are removed.
This way cpd scope is unified with other quality plugins scope. </li>
<li>Global <a href="../../guide/exclusion/">excludes</a> are also applied. </li>
</ul>
<p>Source modifications could be disabled with <code>quality.cpdUnifySources = false</code> </p>
<p>If multiple cpd tasks would be registered (other tasks declared manually), sources would be modified only
for default <code>cpdCheck</code> task. But console reporting and HTML report will be added for all tasks.
Also, all cpd tasks would be disabled with <code>quality.enabled = false</code>    </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, CPD configured for java sources check. To change target language use:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cpd</span> <span class="o">{</span>
    <span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;groovy&#39;</span>
<span class="o">}</span>
</code></pre></div>

</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>CPD will try to check all files in enabled source sets. For example, if you have
both java and groovy sources in main source set then CPD will try to check both
and, most likely, will fail with groovy parse error (as language is java by default).</p>
<p>To solve such cases either manually exclude additional sources:
<div class="codehilite"><pre><span></span><code><span class="n">cpdCheck</span><span class="p">.</span><span class="na">exclude</span> <span class="err">&#39;</span><span class="o">*</span><span class="p">.</span><span class="na">groovy</span><span class="err">&#39;</span>
</code></pre></div>
Or split check in multiple tasks, where each task checks only one language (see below),           </p>
</div>
<h3 id="multiple-file-types-support">Multiple file types support<a class="headerlink" href="#multiple-file-types-support" title="Permanent link">&para;</a></h3>
<p>If you need to check more than one type of files (for example, java and groovy sources), you'll
need to configure separate tasks per each required type. For example:</p>
<div class="codehilite"><pre><span></span><code><span class="n">cpdCheck</span><span class="o">.</span><span class="na">exclude</span> <span class="s1">&#39;*.groovy&#39;</span>                     

<span class="n">task</span> <span class="nf">groovyCpdCheck</span><span class="o">(</span><span class="nl">type:</span><span class="n">de</span><span class="o">.</span><span class="na">aaschmid</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">cpd</span><span class="o">.</span><span class="na">Cpd</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;groovy&#39;</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">allGroovy</span> 
<span class="o">}</span>
</code></pre></div>

<p>Here groovy sources excluded from default <code>cpdCheck</code> task (because cpd plugin by default covers all source sets).
Now the default task will search duplicates only in java files (and only within sources configured in quality plugin).</p>
<p>New task declared for searching groovy duplicates (groovyCpdCheck).</p>
<p>Both tasks will be assigned to <code>check</code>, so by calling <code>gradlew check</code> you'll run both checks.
Console report will be shown for both tasks (and HTML reports generated).</p>
<p>Note that task language will be also mentioned in console report:</p>
<div class="codehilite"><pre><span></span><code>:check
:cpdCheck
2 java duplicates were found by CPD
...

:groovyCpdCheck
2 groovy duplicates were found by CPD
...
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>CPD understands <a href="https://pmd.github.io/latest/pmd_userdocs_cpd.html#supported-languages">many source languages</a>.
But if specified language cannot be found, a fallback mechanism uses <code>net.sourceforge.pmd.cpd.AnyLanguage</code> instead. 
This fallback language does not run ANTLR and therefore also checks duplicates in comments.</p>
<p>This way you can use cpd for searching for duplicates even in pure text files, web templates or other resources.</p>
</div>
<h3 id="multi-module-projects">Multi-module projects<a class="headerlink" href="#multi-module-projects" title="Permanent link">&para;</a></h3>
<p>For multi-module projects, it is <a href="https://github.com/aaschmid/gradle-cpd-plugin#multi-module-project">recommended</a> 
to apply cpd plugin in the root project. This way only one <code>cpdCheck</code> task is created (in the root project), which will
check sources from all modules (it's the only way to find duplicates between different modules).</p>
<p>But quality plugin, should be applied on module level (because all other quality tasks are source set scoped).</p>
<p>Expected root project configuration looks like this:</p>
<div class="codehilite"><pre><span></span><code><span class="n">plugins</span> <span class="o">{</span>
    <span class="n">id</span> <span class="s1">&#39;de.aaschmid.cpd&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.1&#39;</span>
    <span class="n">id</span> <span class="s1">&#39;ru.vyarus.quality&#39;</span> <span class="n">version</span> <span class="s1">&#39;4.2.0&#39;</span> <span class="n">apply</span> <span class="kc">false</span>
<span class="o">}</span>
<span class="n">cpd</span> <span class="o">{</span>
    <span class="c1">// cpd configuration, if required</span>
<span class="o">}</span>

<span class="c1">// possibly other cpd tasks </span>

<span class="n">subprojects</span> <span class="o">{</span>
    <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;java&#39;</span>
    <span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;ru.vyarus.quality&#39;</span>

    <span class="n">quality</span> <span class="o">{</span>
        <span class="c1">// plugin configuration, if required    </span>
    <span class="o">}</span>   
<span class="o">}</span>
</code></pre></div>

<p>This way each module have its own quality plugin, but quality configuration is the same in all modules.</p>
<p>Quality plugin will detect cpd plugin in the root project and configure it the same way as
in single module case. But as quality plugin will apply in each module, only first configured module
will apply <code>cpd</code> modifications of <code>toolVersion</code> and <code>ignoreFailures</code> (assuming this settings are the same for all modules).</p>
<p>Each module will exclude <code>cpdCheck</code> task sources, not covered by quality plugin configuration.
For example, if only main source set configured, each module will exclude test sources.
This way, each module control sources only related to its module and overall <code>cpdCheck</code> sources
configuration would be correct.</p>
<p>Each module will attach all root project's cpd tasks to its check (sub module's <code>check</code> depend on root project tasks).
Imagine if you work in one module you may call <code>check</code> only on module level. With common
quality tasks its clear - all configured module's source sets must be validated.
But you may introduce duplicates (e.g. copied method from other module) and the only
way to detect it is to call root project tasks (so its completely logical to assign root cpd check
to module checks).  </p>
<p>As an example, suppose we have 2 modules <code>mod1</code> and <code>mod2</code> with root project configuration as described above:</p>
<ul>
<li>root project's cpd plugin will be configured</li>
<li><code>mod1</code> will exclude <code>mod1/src/test/java</code> from <code>crpCheck.sources</code></li>
<li><code>:mod1:check</code> depends on <code>:cpdCheck</code></li>
<li><code>mod2</code> will exclude <code>mod2/src/test/java</code> from <code>crpCheck.sources</code></li>
<li><code>:mod2:check</code> depends on <code>:cpdCheck</code> </li>
</ul>
<p>You will also notice, that in the multi-module setup console output will identify class module:</p>
<div class="codehilite"><pre><span></span><code>mod1/sample.cpd.(OtherStruct1.java:3)  [16 lines / 75 tokens]
mod2/sample.cpd.(OtherStruct2.java:3)
  │
 3│    public class OtherStruct1 {
 4│    
 5│        public static void main(String[] args) {
 6│            Math.sqrt(12);
</code></pre></div>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Quality plugin actually search CPD plugin not in the root-most project but in entire
parent chain. So if you have complex gradle project and cpd plugin declared somewhere
in the middle of projects hierarchy, everything will still be properly configured.  </p>
</div>
<h2 id="suppress">Suppress<a class="headerlink" href="#suppress" title="Permanent link">&para;</a></h2>
<p>CPD violations could be <a href="https://pmd.github.io/latest/pmd_userdocs_cpd.html#suppression">suppressed</a>
only for some languages (Java, C/C++, Dart, Go, Javascript, Kotlin, Lua, Matlab, Objective-C, PL/SQL, Python and Swift)
with comments containing CPD-OFF and CPD-ON:</p>
<div class="codehilite"><pre><span></span><code><span class="kd">public</span> <span class="n">Object</span> <span class="nf">someParameterizedFactoryMethod</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="c1">// some unignored code</span>

    <span class="c1">// tell cpd to start ignoring code - CPD-OFF</span>

    <span class="c1">// mission critical code, manually loop unroll</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
    <span class="n">goDoSomethingAwesome</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

    <span class="c1">// resume CPD analysis - CPD-ON</span>

    <span class="c1">// further code will *not* be ignored</span>
<span class="p">}</span>
</code></pre></div>

<p><strong>Java</strong> sources could be also suppressed with annotations:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">//enable suppression</span>
<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="s">&quot;CPD-START&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">Object</span> <span class="nf">someParameterizedFactoryMethod</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
    <span class="c1">// any code here will be ignored for the duplication detection</span>
<span class="p">}</span>

<span class="c1">//disable suppression</span>
<span class="nd">@SuppressWarnings</span><span class="p">(</span><span class="err">&quot;</span><span class="n">CPD</span><span class="o">-</span><span class="n">END</span><span class="p">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">nextMethod</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../pmd/" title="PMD" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                PMD
              </span>
            </div>
          </a>
        
        
          <a href="../spotbugs/" title="SpotBugs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                SpotBugs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2015-2020 Vyacheslav Rusakov
          </div>
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/xvik" target="_blank" rel="noopener" title="github" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/vyarus" target="_blank" rel="noopener" title="twitter" class="md-footer-social__link fa fa-twitter"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>